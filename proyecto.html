<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Propuesta de Proyecto: Timbre Inteligente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Chosen Palette: Slate Gray Neutrals with Sky Blue Accent -->
    <!-- Application Structure Plan: The application is redesigned as a concise, interactive project proposal. A fixed sidebar navigation allows users to quickly jump between key sections: Introduction, Group Members, Components, Circuit, Logic/Code, and Future Improvements. This structure prioritizes direct access to information, suitable for a presentation where key details need to be quickly highlighted and explored. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Project Overview -> Goal: Inform -> Viz: Streamlined hero section with UDH logo and project title -> Interaction: N/A -> Justification: Provides immediate, clear context for the proposal -> Library/Method: Tailwind.
        - Report Info: Group Members -> Goal: Inform -> Viz: Simple list of names after intro -> Interaction: N/A -> Justification: Direct and uncluttered presentation of team members -> Library/Method: Tailwind.
        - Report Info: Hardware/Software list -> Goal: Inform -> Viz: Interactive cards with icons -> Interaction: Hover for details -> Justification: Visually engaging and scannable for components -> Library/Method: Tailwind, FontAwesome.
        - Report Info: Pull-up vs Pull-down circuit -> Goal: Organize/Compare -> Viz: HTML/CSS based visual diagram -> Interaction: Toggle buttons to switch between diagrams -> Justification: Clearly illustrates circuit options -> Library/Method: Tailwind.
        - Report Info: Button Debouncing -> Goal: Explain -> Viz: Animated Line Chart -> Interaction: Buttons to simulate 'bouncy' vs 'clean' signal -> Justification: Makes an abstract electrical concept tangible -> Library/Method: Chart.js.
        - Report Info: API Comparison & Code -> Goal: Inform/Provide -> Viz: Flow diagram for WhatsApp notification, code block -> Interaction: Copy code button -> Justification: Explains the process and provides direct implementation -> Library/Method: Tailwind, JS.
        - Report Info: Future Improvements -> Goal: Inspire -> Viz: Static cards -> Interaction: N/A (removed animations) -> Justification: Presents extension ideas clearly without distractions -> Library/Method: Tailwind, JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .active-nav { color: #0284c7; background-color: #1e293b; } /* Darker background for active nav */
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 400px; }
        .static-card {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            border-radius: 0.75rem;
            height: 100%;
            width: 100%;
        }
        .component-icon { transition: transform 0.2s ease; } /* Slightly reduced transition */
        .component-icon:hover { transform: scale(1.03); } /* Reduced hover scale */
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Reverted to previous dark theme colors
                        'primary-blue': '#10367D', // Not used directly, but kept for reference if needed
                        'light-gray': '#EBEBEB',   // Not used directly, but kept for reference if needed
                        'secondary-blue-accent': '#A5CEF0', // Not used directly, but kept for reference if needed
                        'darker-primary-blue': '#0A265E', // Not used directly, but kept for reference if needed
                        'green-whatsapp': '#25D366', // Standard WhatsApp green
                        'red-error': '#DC2626', // Standard red for errors/simulations
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-900 text-slate-100">

    <div class="flex flex-col min-h-screen">
        <main class="flex-1 p-4 sm:p-6 lg:p-8 pb-24 md:pb-28"> <!-- Added padding-bottom for fixed nav -->
            <section id="introduccion" class="min-h-screen flex flex-col justify-center items-center text-center">
                 <div class="p-8 rounded-2xl max-w-4xl mx-auto">
                    <img src="Logo UDH 2.png" alt="Logo UDH" class="h-auto w-full max-w-xs mx-auto mb-6">
                    <h2 class="text-4xl font-bold text-white mb-4">Propuesta de Proyecto: Timbre Inteligente con Alertas de WhatsApp</h2>
                    <p class="text-lg text-slate-300 mb-6 max-w-2xl mx-auto">
                        Este proyecto para la clase de Sistemas de Control presenta un timbre IoT que, al ser presionado, envía una notificación instantánea a WhatsApp.
                    </p>
                    <a href="#integrantes" class="inline-block bg-sky-600 text-white font-bold py-3 px-8 rounded-full hover:bg-sky-700 transition-transform duration-300 transform hover:scale-105">
                        Explorar Propuesta <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
            </section>

            <section id="integrantes" class="min-h-screen py-20 bg-slate-900">
                <div class="p-8 rounded-2xl max-w-4xl mx-auto text-center">
                    <h2 class="text-3xl font-bold text-slate-50 mb-8">Integrantes del Grupo</h2>
                    <div class="flex flex-wrap justify-center gap-6">
                        <div class="p-3 bg-slate-700 rounded-lg shadow-sm text-slate-100 font-semibold">Alessandra Flores</div>
                        <div class="p-3 bg-slate-700 rounded-lg shadow-sm text-slate-100 font-semibold">Oscar A. Coello</div>
                        <div class="p-3 bg-slate-700 rounded-lg shadow-sm text-slate-100 font-semibold">Carlos Velázques</div>
                        <div class="p-3 bg-slate-700 rounded-lg shadow-sm text-slate-100 font-semibold">José A. Gonzalez</div>
                    </div>
                </div>
            </section>

            <section id="componentes" class="min-h-screen py-20">
                <div class="p-8 rounded-2xl max-w-6xl mx-auto">
                    <h2 class="text-3xl font-bold text-center mb-2 text-white">Componentes Necesarios</h2>
                    <p class="text-slate-300 text-center mb-12 max-w-3xl mx-auto">Hardware y software esenciales para el timbre inteligente.</p>

                    <div class="grid md:grid-cols-2 gap-10">
                        <div>
                            <h3 class="text-2xl font-semibold mb-6 flex items-center text-white"><i class="fas fa-memory mr-3 text-sky-400"></i>Hardware</h3>
                            <div class="space-y-4">
                                <div class="flex items-start p-4 bg-slate-700 rounded-lg component-icon">
                                    <i class="fas fa-microchip text-2xl text-sky-400 mt-1"></i>
                                    <div class="ml-4">
                                        <h4 class="font-bold text-sky-400">Microcontrolador (Arduino Uno)</h4>
                                        <p class="text-slate-300 text-sm">El cerebro del proyecto, encargado de la lógica y control.</p>
                                    </div>
                                </div>
                                <div class="flex items-start p-4 bg-slate-700 rounded-lg component-icon">
                                    <i class="fas fa-wifi text-2xl text-sky-400 mt-1"></i>
                                    <div class="ml-4">
                                        <h4 class="font-bold">Módulo Wi-Fi (ESP8266 como módulo)</h4>
                                        <p class="text-slate-300 text-sm">Proporciona conectividad Wi-Fi al Arduino Uno para enviar alertas a WhatsApp.</p>
                                    </div>
                                </div>
                                <div class="flex items-start p-4 bg-slate-700 rounded-lg component-icon">
                                    <i class="fas fa-toggle-on text-2xl text-sky-400 mt-1"></i>
                                    <div class="ml-4">
                                        <h4 class="font-bold">Botón Pulsador Momentáneo</h4>
                                        <p class="text-slate-300 text-sm">El timbre físico.</p>
                                    </div>
                                </div>
                                 <div class="flex items-start p-4 bg-slate-700 rounded-lg component-icon">
                                    <i class="fas fa-wave-square text-2xl text-sky-400 mt-1"></i>
                                    <div class="ml-4">
                                        <h4 class="font-bold">Resistencias (10KΩ y 220Ω)</h4>
                                        <p class="text-slate-300 text-sm">10KΩ para pull-down, 220Ω para LED opcional.</p>
                                    </div>
                                </div>
                                <div class="flex items-start p-4 bg-slate-700 rounded-lg component-icon">
                                    <i class="fas fa-border-all text-2xl text-sky-400 mt-1"></i>
                                    <div class="ml-4">
                                        <h4 class="font-bold">Protoboard y Cables Jumper</h4>
                                        <p class="text-slate-300 text-sm">Para ensamblaje temporal.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-2xl font-semibold mb-6 flex items-center text-white"><i class="fab fa-uncharted mr-3 text-sky-400"></i>Software y Servicios</h3>
                            <div class="space-y-4">
                                <div class="flex items-start p-4 bg-slate-700 rounded-lg component-icon">
                                    <i class="fab fa-arduino text-2xl text-sky-400 mt-1"></i>
                                    <div class="ml-4">
                                        <h4 class="font-bold">Arduino IDE</h4>
                                        <p class="text-slate-300 text-sm">Entorno para programar el microcontrolador.</p>
                                    </div>
                                </div>
                                <div class="flex items-start p-4 bg-slate-700 rounded-lg component-icon">
                                    <i class="fas fa-book text-2xl text-sky-400 mt-1"></i>
                                    <div class="ml-4">
                                        <h4 class="font-bold">Librerías (SoftwareSerial, HTTPClient, UrlEncode)</h4>
                                        <p class="text-slate-300 text-sm">Para comunicación serial con el módulo Wi-Fi y envío de solicitudes HTTP.</p>
                                    </div>
                                </div>
                                <div class="flex items-start p-4 bg-slate-700 rounded-lg component-icon">
                                    <i class="fab fa-whatsapp text-2xl text-green-500 mt-1"></i>
                                    <div class="ml-4">
                                        <h4 class="font-bold">API de CallMeBot</h4>
                                        <p class="text-slate-300 text-sm">Servicio para enviar mensajes a WhatsApp.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="circuito" class="min-h-screen py-20">
                 <div class="p-8 rounded-2xl max-w-6xl mx-auto">
                    <h2 class="text-3xl font-bold text-center mb-2 text-white">Montaje del Circuito</h2>
                    <p class="text-slate-300 text-center mb-12 max-w-3xl mx-auto">Conexión del botón al microcontrolador. Se visualizan configuraciones pull-up y pull-down.</p>

                    <div class="flex justify-center mb-8">
                        <div class="inline-flex rounded-md shadow-sm" role="group">
                            <button type="button" id="btn-pullup" class="circuit-toggle-btn active-btn px-6 py-3 text-sm font-medium text-white bg-sky-600 border border-sky-600 rounded-l-lg hover:bg-sky-700">Pull-Up (Recomendado)</button>
                            <button type="button" id="btn-pulldown" class="circuit-toggle-btn px-6 py-3 text-sm font-medium text-slate-100 bg-slate-700 border-t border-b border-slate-600 hover:bg-slate-600">Pull-Down</button>
                        </div>
                    </div>

                    <div id="diagram-container" class="grid lg:grid-cols-2 gap-8 items-center">
                        <div id="pullup-diagram" class="circuit-diagram">
                             <div class="p-6 border-2 border-dashed rounded-lg border-slate-600">
                                <h4 class="font-bold text-lg mb-4 text-center text-slate-50">Configuración Pull-Up</h4>
                                <div class="space-y-4 text-sm">
                                    <div class="flex items-center justify-between p-3 bg-slate-700 rounded-md">
                                        <span class="font-mono text-slate-100">Pulsador (Terminal 1)</span> <i class="fas fa-long-arrow-alt-right text-slate-500"></i> <span class="font-mono bg-sky-700 text-sky-100 px-2 py-1 rounded">GPIO Pin (ej. D2)</span>
                                    </div>
                                     <div class="flex items-center justify-between p-3 bg-slate-700 rounded-md">
                                        <span class="font-mono text-slate-100">Pulsador (Terminal 2)</span> <i class="fas fa-long-arrow-alt-right text-slate-500"></i> <span class="font-mono bg-red-700 text-red-100 px-2 py-1 rounded">GND</span>
                                    </div>
                                </div>
                                <p class="mt-4 text-xs text-slate-400 text-center">No se necesita resistencia externa. Pin configurado como `INPUT_PULLUP`. Lee `LOW` al presionar.</p>
                            </div>
                        </div>

                        <div id="pulldown-diagram" class="circuit-diagram hidden">
                             <div class="p-6 border-2 border-dashed rounded-lg border-slate-600">
                                <h4 class="font-bold text-lg mb-4 text-center text-slate-50">Configuración Pull-Down</h4>
                                 <div class="space-y-4 text-sm">
                                    <div class="flex items-center justify-between p-3 bg-slate-700 rounded-md">
                                        <span class="font-mono text-slate-100">Pulsador (Terminal 1)</span> <i class="fas fa-long-arrow-alt-right text-slate-500"></i> <span class="font-mono bg-sky-700 text-sky-100 px-2 py-1 rounded">GPIO Pin (ej. D2)</span>
                                    </div>
                                     <div class="flex items-center justify-between p-3 bg-slate-700 rounded-md">
                                        <span class="font-mono text-slate-100">Pulsador (Terminal 2)</span> <i class="fas fa-long-arrow-alt-right text-slate-500"></i> <span class="font-mono bg-green-700 text-green-100 px-2 py-1 rounded">3.3V</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-slate-700 rounded-md">
                                        <span class="font-mono text-slate-100">GPIO Pin (ej. D2)</span> <i class="fas fa-long-arrow-alt-right text-slate-500"></i> <span class="font-mono bg-yellow-700 text-yellow-100 px-2 py-1 rounded">Resistencia 10KΩ</span> <i class="fas fa-long-arrow-alt-right text-slate-500"></i> <span class="font-mono bg-red-700 text-red-100 px-2 py-1 rounded">GND</span>
                                    </div>
                                </div>
                                <p class="mt-4 text-xs text-slate-400 text-center">Requiere resistencia externa. Lee `HIGH` al presionar.</p>
                            </div>
                        </div>

                        <div class="text-slate-300">
                             <p class="mb-4">Un pin de entrada digital debe tener un estado definido. Las resistencias pull-up/pull-down aseguran un estado estable, eliminando ruido eléctrico y lecturas erráticas.</p>
                            <div class="bg-sky-700 text-sky-100 p-4 rounded-lg text-sm">
                                <i class="fas fa-exclamation-triangle mr-2"></i><strong>Advertencia de Voltaje:</strong> ESP32/ESP8266 operan a <strong class="font-bold">3.3V</strong>. Conectar a 5V puede dañarlos.
                            </div>
                        </div>
                    </div>
                 </div>
            </section>

             <section id="logica" class="min-h-screen py-20">
                <div class="p-8 rounded-2xl max-w-6xl mx-auto">
                    <h2 class="text-3xl font-bold text-center mb-2 text-white">Lógica y Programación</h2>
                    <p class="text-slate-300 text-center mb-12 max-w-3xl mx-auto">El código es el alma del proyecto. Conceptos clave: "debouncing", conexión Wi-Fi y API de WhatsApp.</p>
                    
                    <div class="space-y-16">
                        <div>
                            <h3 class="text-2xl font-semibold mb-4 text-center text-white">El Problema del "Rebote" del Botón (Debouncing)</h3>
                            <p class="text-slate-300 text-center mb-6 max-w-2xl mx-auto">Un botón físico genera múltiples señales falsas al presionarse. El "debouncing" ignora estas vibraciones para detectar una sola pulsación real.</p>
                            <div class="chart-container">
                                <canvas id="debounceChart"></canvas>
                            </div>
                            <div class="flex justify-center mt-4 space-x-2">
                                <button id="simulateBouncy" class="px-4 py-2 text-sm font-medium bg-red-700 text-red-100 rounded-lg">Simular Señal con Rebote</button>
                                <button id="simulateClean" class="px-4 py-2 text-sm font-medium bg-green-700 text-green-100 rounded-lg">Simular Señal Limpia (Debounced)</button>
                            </div>
                        </div>

                        <div>
                             <h3 class="text-2xl font-semibold mb-4 text-center text-white">Flujo de Notificación de WhatsApp</h3>
                             <p class="text-slate-300 text-center mb-8 max-w-2xl mx-auto">Usamos CallMeBot. El Arduino Uno envía comandos AT al módulo ESP8266, que a su vez realiza la solicitud HTTP con API Key, número y mensaje. CallMeBot entrega el mensaje a WhatsApp.</p>
                             <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 text-center">
                                <div class="p-4 rounded-lg bg-slate-700 flex flex-col items-center w-40 h-28 justify-center">
                                    <i class="fas fa-hand-pointer text-3xl text-sky-400 mb-2"></i>
                                    <span class="font-semibold text-slate-100">1. Pulsación</span>
                                </div>
                                <i class="fas fa-long-arrow-alt-right text-3xl text-slate-600 hidden md:block"></i>
                                <i class="fas fa-long-arrow-alt-down text-3xl text-slate-600 md:hidden"></i>
                                <div class="p-4 rounded-lg bg-slate-700 flex flex-col items-center w-40 h-28 justify-center">
                                    <i class="fas fa-wifi text-3xl text-sky-400 mb-2"></i>
                                    <span class="font-semibold text-slate-100">2. Envío HTTP (vía ESP8266)</span>
                                </div>
                                <i class="fas fa-long-arrow-alt-right text-3xl text-slate-600 hidden md:block"></i>
                                <i class="fas fa-long-arrow-alt-down text-3xl text-slate-600 md:hidden"></i>
                                <div class="p-4 rounded-lg bg-slate-700 flex flex-col items-center w-40 h-28 justify-center">
                                    <i class="fas fa-server text-3xl text-sky-400 mb-2"></i>
                                    <span class="font-semibold text-slate-100">3. API CallMeBot</span>
                                </div>
                                 <i class="fas fa-long-arrow-alt-right text-3xl text-slate-600 hidden md:block"></i>
                                 <i class="fas fa-long-arrow-alt-down text-3xl text-slate-600 md:hidden"></i>
                                 <div class="p-4 rounded-lg bg-green-700 flex flex-col items-center w-40 h-28 justify-center">
                                    <i class="fab fa-whatsapp text-3xl text-green-500 mb-2"></i>
                                    <span class="font-semibold text-green-100">4. Notificación</span>
                                 </div>
                             </div>
                        </div>

                        <div>
                            <h3 class="text-2xl font-semibold mb-6 text-center text-white">Código Fuente del Sketch (Arduino Uno + ESP8266)</h3>
                            <div class="bg-slate-700 rounded-lg p-4 text-sm text-slate-100 font-mono relative">
                                <pre id="code-block"><code class="language-cpp">
#include &lt;SoftwareSerial.h&gt; // Para comunicación serial con ESP8266

// --- CONFIGURACIÓN ---
const int buttonPin = 2; // Pin digital del Arduino donde está conectado el botón
long lastDebounceTime = 0;
long debounceDelay = 50; // 50 milisegundos
int lastButtonState = HIGH;

// Pines para SoftwareSerial con ESP8266
// RX del Arduino (pin 10) al TX del ESP8266
// TX del Arduino (pin 11) al RX del ESP8266
SoftwareSerial espSerial(10, 11); // RX, TX

// Credenciales Wi-Fi (¡Cambia esto!)
const char* ssid = "TU_WIFI_SSID";
const char* password = "TU_WIFI_PASSWORD";

// Credenciales de CallMeBot (¡Cambia esto!)
String phoneNumber = "+1234567890"; // Tu número con código de país (ej. +34621...)
String apiKey = "TU_API_KEY_CALLMEBOT"; // Tu API Key de CallMeBot

// Función para enviar comandos AT al ESP8266 y esperar respuesta
String sendATCommand(String command, const int timeout) {
  String response = "";
  espSerial.println(command);
  long startTime = millis();
  while (millis() - startTime < timeout) {
    if (espSerial.available()) {
      char c = espSerial.read();
      response += c;
    }
  }
  Serial.print("Comando: ");
  Serial.println(command);
  Serial.print("Respuesta ESP: ");
  Serial.println(response);
  return response;
}

// Función para codificar URL (básica, para caracteres comunes)
String urlEncode(String str) {
  String encodedString = "";
  char c;
  char code0;
  char code1;
  char code2;
  for (int i = 0; i < str.length(); i++) {
    c = str.charAt(i);
    if (c == ' ') {
      encodedString += "+";
    } else if (isalnum(c) || c == '-' || c == '_' || c == '.' || c == '~') {
      encodedString += c;
    } else {
      code1 = (c & 0xf) + '0';
      if ((c & 0xf) > 9) {
        code1 = (c & 0xf) - 10 + 'A';
      }
      c = (c >> 4) & 0xf;
      code0 = c + '0';
      if (c > 9) {
        code0 = c - 10 + 'A';
      }
      encodedString += '%';
      encodedString += code0;
      encodedString += code1;
    }
    yield(); // Permite que otras tareas se ejecuten (importante para ESP)
  }
  return encodedString;
}

// Función para enviar el mensaje de WhatsApp a través del ESP8266
void sendMessage(String message) {
  Serial.println("Enviando mensaje WhatsApp...");

  // 1. Configurar ESP8266 en modo estación (cliente)
  sendATCommand("AT+CWMODE=1", 1000);
  delay(1000);

  // 2. Conectar a la red Wi-Fi
  String cmd = "AT+CWJAP=\"";
  cmd += ssid;
  cmd += "\",\"";
  cmd += password;
  cmd += "\"";
  sendATCommand(cmd, 10000); // Esperar hasta 10 segundos para conectar
  delay(3000); // Pequeña espera adicional

  // 3. Iniciar conexión TCP con el servidor de CallMeBot
  String url = "api.callmebot.com";
  String port = "80"; // CallMeBot usa HTTP, no HTTPS directamente para AT comandos simples
  String connectCmd = "AT+CIPSTART=\"TCP\",\"" + url + "\"," + port;
  String connectResponse = sendATCommand(connectCmd, 5000);
  if (!connectResponse.indexOf("OK") == -1) { // Si la conexión TCP fue exitosa
    Serial.println("Conexión TCP establecida.");

    // 4. Construir la solicitud HTTP GET
    String encodedMessage = urlEncode(message);
    String request = "GET /whatsapp.php?phone=" + phoneNumber + "&text=" + encodedMessage + "&apikey=" + apiKey + " HTTP/1.1\r\n";
    request += "Host: api.callmebot.com\r\n";
    request += "Connection: close\r\n\r\n"; // Cierra la conexión después de la solicitud

    // 5. Enviar la solicitud HTTP
    String sendCmd = "AT+CIPSEND=" + String(request.length());
    sendATCommand(sendCmd, 1000); // Enviar el comando para indicar la longitud de los datos
    delay(100); // Pequeña espera antes de enviar los datos
    sendATCommand(request, 5000); // Enviar los datos de la solicitud HTTP

    // 6. Cerrar la conexión TCP
    sendATCommand("AT+CIPCLOSE", 1000);
    Serial.println("Mensaje enviado (vía ESP8266).");
  } else {
    Serial.println("Error al establecer conexión TCP con CallMeBot.");
  }
}

void setup() {
  Serial.begin(9600); // Serial para depuración en Arduino IDE
  espSerial.begin(115200); // Serial para comunicación con ESP8266

  pinMode(buttonPin, INPUT_PULLUP); // Configurar pin del botón con pull-up interno

  Serial.println("Iniciando Timbre Inteligente...");
  Serial.println("Configurando ESP8266...");
  
  // Reiniciar ESP8266 para asegurar un estado limpio
  sendATCommand("AT+RST", 2000);
  delay(3000); // Esperar a que el ESP se reinicie

  // Verificar que el ESP8266 esté respondiendo
  String response = sendATCommand("AT", 1000);
  if (response.indexOf("OK") == -1) {
    Serial.println("Error: ESP8266 no responde. Verifica las conexiones.");
    while(true); // Detener el programa si el ESP no responde
  }

  // Conectar a Wi-Fi al inicio
  Serial.println("Conectando a WiFi...");
  String connectResponse = sendATCommand("AT+CWJAP=\"" + String(ssid) + "\",\"" + String(password) + "\"", 15000);
  if (connectResponse.indexOf("WIFI CONNECTED") == -1) {
    Serial.println("Error: No se pudo conectar a WiFi. Verifica SSID/Password.");
    while(true); // Detener el programa si no hay WiFi
  }
  Serial.println("WiFi conectado!");
}

void loop() {
  int reading = digitalRead(buttonPin);

  // Lógica de Debounce
  if (reading != lastButtonState) {
    lastDebounceTime = millis();
  }

  if ((millis() - lastDebounceTime) > debounceDelay) {
    if (reading == LOW) { // Botón presionado (pull-up)
       Serial.println("¡Botón presionado!");
       sendMessage("¡Alguien esta en la puerta!"); // Mensaje de alerta
       // Esperar hasta que el botón se suelte para evitar envíos múltiples
       while(digitalRead(buttonPin) == LOW) {
         delay(10);
       }
       Serial.println("Botón liberado.");
    }
  }
  
  lastButtonState = reading;
  delay(10); // Pequeño retraso para evitar lecturas rápidas innecesarias
}
                                </code></pre>
                            </div>
                            <div class="mt-8">
                                <h3 class="text-2xl font-semibold mb-4 text-center text-white">Explicación del Código</h3>
                                <div class="text-slate-300 space-y-4">
                                    <p>Este sketch de Arduino está diseñado para un **Arduino Uno** que se comunica con un **módulo Wi-Fi ESP8266** usando comandos AT a través de la comunicación serial. Aquí los puntos clave:</p>
                                    <ul class="list-disc list-inside space-y-2">
                                        <li>**`SoftwareSerial`:** Se utiliza para establecer una comunicación serial con el módulo ESP8266 en los pines digitales 10 (RX) y 11 (TX) del Arduino Uno.</li>
                                        <li>**`sendATCommand()`:** Esta función es crucial. Envía un comando AT al ESP8266 y espera una respuesta, lo que permite al Arduino controlar el módulo Wi-Fi.</li>
                                        <li>**`urlEncode()`:** Una función básica para codificar el mensaje de WhatsApp, asegurando que caracteres especiales se transmitan correctamente en la URL.</li>
                                        <li>**`sendMessage()`:** Esta función encapsula la lógica para enviar la alerta de WhatsApp. Envía una secuencia de comandos AT al ESP8266 para:
                                            <ol class="list-decimal list-inside ml-4 mt-2">
                                                <li>Configurar el ESP en modo estación (`AT+CWMODE=1`).</li>
                                                <li>Conectarse a la red Wi-Fi (`AT+CWJAP`).</li>
                                                <li>Abrir una conexión TCP al servidor de CallMeBot (`AT+CIPSTART`).</li>
                                                <li>Construir y enviar la solicitud HTTP GET (`AT+CIPSEND` y los datos de la solicitud).</li>
                                                <li>Cerrar la conexión TCP (`AT+CIPCLOSE`).</li>
                                            </ol>
                                        </li>
                                        <li>**`setup()`:** Inicializa la comunicación serial con el PC y el ESP8266, configura el pin del botón y realiza una conexión inicial al Wi-Fi.</li>
                                        <li>**`loop()`:** Lee continuamente el estado del botón. Si detecta una pulsación válida (usando la lógica de debouncing), llama a `sendMessage()` para enviar la alerta a WhatsApp.</li>
                                    </ul>
                                    <p class="text-sm text-red-400 mt-4">**Nota Importante:** Este es un sketch simplificado para demostración. La gestión robusta de comandos AT (manejo de errores, reintentos, análisis de respuestas complejas) es más avanzada y requeriría un código más extenso en un entorno de producción.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="visualizaciones" class="min-h-screen py-20 bg-slate-900">
                <div class="p-8 rounded-2xl max-w-6xl mx-auto text-center">
                    <h2 class="text-3xl font-bold text-white mb-12">Visualizaciones del Proyecto</h2>
                    <div class="grid md:grid-cols-3 gap-8 items-center justify-center">
                        <div class="flex flex-col items-center">
                            <h3 class="text-xl font-semibold mb-4 text-white">Notificación de WhatsApp</h3>
                            <img src="whatsapp.jpeg" alt="Imagen de Notificación de WhatsApp" class="rounded-lg shadow-lg w-full max-w-[200px] h-auto object-contain">
                            <p class="text-slate-300 text-sm mt-4">Ejemplo de la alerta recibida en el teléfono.</p>
                        </div>
                        <div class="flex flex-col items-center">
                            <h3 class="text-xl font-semibold mb-4 text-white">Circuito Eléctrico (Ejemplo)</h3>
                            <img src="circuito.jpeg" alt="Imagen de Circuito Eléctrico" class="rounded-lg shadow-lg w-full max-w-md h-auto object-contain">
                            <p class="text-slate-300 text-sm mt-4">Representación del montaje del Arduino Uno con el módulo Wi-Fi y el botón.</p>
                        </div>
                        <div class="flex flex-col items-center">
                            <h3 class="text-xl font-semibold mb-4 text-white">Cámara Pequeña (Ejemplo)</h3>
                            <img src="camara.jpeg" alt="Imagen de Cámara Pequeña" class="rounded-lg shadow-lg w-full max-w-[150px] h-auto object-contain">
                            <p class="text-slate-300 text-sm mt-4">Ejemplo de una cámara compacta para futuras expansiones.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="mejoras" class="min-h-screen py-20">
                <div class="p-8 rounded-2xl max-w-6xl mx-auto">
                    <h2 class="text-3xl font-bold text-center mb-2 text-white">Mejoras y Expansiones Futuras</h2>
                    <p class="text-slate-300 text-center mb-12 max-w-3xl mx-auto">Este proyecto es un punto de partida. Su diseño modular permite muchas mejoras para un sistema de monitoreo y control más completo.</p>
                    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
                        <div class="static-card bg-sky-700 text-sky-100">
                            <i class="fas fa-comment-dots text-4xl mb-3"></i>
                            <h4 class="font-bold text-lg">Alertas Contextuales</h4>
                            <p class="text-sm text-center">Envía diferentes mensajes según la duración de la pulsación (corto: "Timbre", largo: "Urgente").</p>
                        </div>
                         <div class="static-card bg-indigo-700 text-indigo-100">
                            <i class="fas fa-camera text-4xl mb-3"></i>
                            <h4 class="font-bold text-lg">Captura de Imagen con Cámara</h4>
                            <p class="text-sm text-center">Al pulsar el timbre, se activa una cámara (ej. ESP32-CAM) para tomar una fotografía y enviarla junto con la alerta de WhatsApp.</p>
                        </div>
                        <div class="static-card bg-amber-700 text-amber-100">
                            <i class="fas fa-exchange-alt text-4xl mb-3"></i>
                            <h4 class="font-bold text-lg">Comunicación Bidireccional</h4>
                            <p class="text-sm text-center">Usa APIs avanzadas (ej. Twilio) para enviar comandos al ESP desde WhatsApp.</p>
                        </div>
                         <div class="static-card bg-slate-700 text-slate-100">
                            <i class="fas fa-battery-full text-4xl mb-3"></i>
                            <h4 class="font-bold text-lg">Alimentación por Batería</h4>
                            <p class="text-sm text-center">Optimiza el consumo de energía (modos de sueño) para operación con batería.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="aplicaciones" class="min-h-screen py-20 bg-slate-900">
                <div class="p-8 rounded-2xl max-w-4xl mx-auto text-center">
                    <h2 class="text-3xl font-bold text-white mb-12">Aplicaciones del Proyecto</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="static-card bg-sky-700 text-sky-100">
                            <i class="fas fa-home text-4xl mb-3"></i>
                            <h4 class="font-bold text-lg">Hogar Inteligente</h4>
                            <p class="text-sm text-center">Notificaciones de visitantes en tiempo real, incluso cuando no estás en casa.</p>
                        </div>
                        <div class="static-card bg-red-700 text-red-100">
                            <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
                            <h4 class="font-bold text-lg">Emergencias en Fábrica</h4>
                            <p class="text-sm text-center">Alertas instantáneas a personal clave ante fallos de maquinaria o situaciones críticas.</p>
                        </div>
                        <div class="static-card bg-green-700 text-green-100">
                            <i class="fas fa-hands-helping text-4xl mb-3"></i>
                            <h4 class="font-bold text-lg">Asistencia en Fábrica</h4>
                            <p class="text-sm text-center">Botón de llamada para asistencia técnica o reabastecimiento en líneas de producción.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <aside id="sidebar" class="bg-slate-800 w-full fixed bottom-0 left-0 p-4 md:p-6 z-40 shadow-xl flex justify-center items-center transform translate-y-full md:translate-y-0 transition-transform duration-300 ease-in-out">
            <nav id="nav-menu">
                <ul class="flex space-x-4 md:space-x-8 justify-center">
                    <li><a href="#introduccion" class="nav-link flex flex-col items-center p-2 rounded-lg text-slate-300 hover:bg-slate-700 hover:text-sky-400 transition-colors duration-200"><i class="fas fa-rocket text-xl"></i><span class="text-xs mt-1 hidden md:block">Introducción</span></a></li>
                    <li><a href="#integrantes" class="nav-link flex flex-col items-center p-2 rounded-lg text-slate-300 hover:bg-slate-700 hover:text-sky-400 transition-colors duration-200"><i class="fas fa-users text-xl"></i><span class="text-xs mt-1 hidden md:block">Integrantes</span></a></li>
                    <li><a href="#componentes" class="nav-link flex flex-col items-center p-2 rounded-lg text-slate-300 hover:bg-slate-700 hover:text-sky-400 transition-colors duration-200"><i class="fas fa-cogs text-xl"></i><span class="text-xs mt-1 hidden md:block">Componentes</span></a></li>
                    <li><a href="#circuito" class="nav-link flex flex-col items-center p-2 rounded-lg text-slate-300 hover:bg-slate-700 hover:text-sky-400 transition-colors duration-200"><i class="fas fa-microchip text-xl"></i><span class="text-xs mt-1 hidden md:block">Montaje</span></a></li>
                    <li><a href="#logica" class="nav-link flex flex-col items-center p-2 rounded-lg text-slate-300 hover:bg-slate-700 hover:text-sky-400 transition-colors duration-200"><i class="fas fa-code text-xl"></i><span class="text-xs mt-1 hidden md:block">Lógica y Código</span></a></li>
                    <li><a href="#mejoras" class="nav-link flex flex-col items-center p-2 rounded-lg text-slate-300 hover:bg-slate-700 hover:text-sky-400 transition-colors duration-200"><i class="fas fa-lightbulb text-xl"></i><span class="text-xs mt-1 hidden md:block">Mejoras Futuras</span></a></li>
                    <li><a href="#aplicaciones" class="nav-link flex flex-col items-center p-2 rounded-lg text-slate-300 hover:bg-slate-700 hover:text-sky-400 transition-colors duration-200"><i class="fas fa-th-large text-xl"></i><span class="text-xs mt-1 hidden md:block">Aplicaciones</span></a></li>
                </ul>
            </nav>
        </aside>

        <button id="menu-toggle" class="md:hidden fixed bottom-4 right-4 z-50 p-2 bg-slate-800 rounded-full shadow-lg">
            <i class="fas fa-bars text-white"></i>
        </button>
        
        <div id="overlay" class="md:hidden fixed inset-0 bg-black opacity-50 z-30 hidden"></div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('main section');
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');

    const setActiveLink = () => {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.offsetHeight;
            // Adjust for the fixed bottom navigation height
            const navHeight = sidebar.offsetHeight; 
            if (pageYOffset >= sectionTop - navHeight && pageYOffset < sectionTop + sectionHeight - navHeight) {
                current = section.getAttribute('id');
            }
        });

        navLinks.forEach(link => {
            link.classList.remove('active-nav');
            if (link.getAttribute('href').substring(1) === current) {
                link.classList.add('active-nav');
            }
        });
    };
    
    window.addEventListener('scroll', setActiveLink);
    setActiveLink(); // Set active link on initial load
    
    navLinks.forEach(link => {
        link.addEventListener('click', () => {
             if (window.innerWidth < 768) {
                sidebar.classList.add('translate-y-full'); // Hide sidebar on mobile after click
                overlay.classList.add('hidden');
            }
        });
    });

    menuToggle.addEventListener('click', () => {
        sidebar.classList.toggle('translate-y-full');
        overlay.classList.toggle('hidden');
    });

    overlay.addEventListener('click', () => {
        sidebar.classList.add('translate-y-full');
        overlay.classList.add('hidden');
    });

    const pullupBtn = document.getElementById('btn-pullup');
    const pulldownBtn = document.getElementById('btn-pulldown');
    const pullupDiagram = document.getElementById('pullup-diagram');
    const pulldownDiagram = document.getElementById('pulldown-diagram');
    const circuitToggleBtns = document.querySelectorAll('.circuit-toggle-btn');

    pullupBtn.addEventListener('click', () => {
        pullupDiagram.classList.remove('hidden');
        pulldownDiagram.classList.add('hidden');
        circuitToggleBtns.forEach(b => b.classList.remove('active-btn', 'bg-sky-600', 'text-white'));
        pullupBtn.classList.add('active-btn', 'bg-sky-600', 'text-white');
        pulldownBtn.classList.add('bg-slate-700', 'text-slate-100');
    });
    pulldownBtn.addEventListener('click', () => {
        pulldownDiagram.classList.remove('hidden');
        pullupDiagram.classList.add('hidden');
        circuitToggleBtns.forEach(b => b.classList.remove('active-btn', 'bg-sky-600', 'text-white'));
        pulldownBtn.classList.add('active-btn', 'bg-sky-600', 'text-white');
        pullupBtn.classList.add('bg-slate-700', 'text-slate-100');

    });

    const ctx = document.getElementById('debounceChart').getContext('2d');
    let debounceChart;

    const bouncyData = {
        labels: Array.from({length: 20}, (_, i) => i + 1),
        datasets: [{
            label: 'Señal con Rebote',
            data: [1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            borderColor: 'rgba(239, 68, 68, 0.8)',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            fill: true,
            stepped: true,
        }]
    };

    const cleanData = {
        labels: Array.from({length: 20}, (_, i) => i + 1),
        datasets: [{
            label: 'Señal Limpia (Debounced)',
            data: [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            borderColor: 'rgba(16, 185, 129, 0.8)',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            fill: true,
            stepped: true,
        }]
    };
    
    function createChart(data) {
        if (debounceChart) {
            debounceChart.destroy();
        }
        debounceChart = new Chart(ctx, {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 1.2,
                        ticks: {
                            stepSize: 1,
                            callback: function(value) {
                                if (value === 1) return 'HIGH';
                                if (value === 0) return 'LOW';
                                return '';
                            },
                            color: '#e2e8f0' /* Light text for dark theme */
                        },
                        grid: {
                            color: '#475569' /* Darker grid lines */
                        }
                    },
                    x: {
                         title: { 
                            display: true, 
                            text: 'Tiempo (milisegundos)',
                            color: '#e2e8f0' /* Light text for dark theme */
                         },
                         ticks: {
                            color: '#e2e8f0' /* Light text for dark theme */
                         },
                         grid: {
                            color: '#475569' /* Darker grid lines */
                        }
                    }
                },
                plugins: {
                    legend: { 
                        position: 'top',
                        labels: {
                            color: '#e2e8f0' /* Light text for dark theme */
                        }
                    },
                    tooltip: { mode: 'index', intersect: false }
                }
            }
        });
    }

    document.getElementById('simulateBouncy').addEventListener('click', () => createChart(bouncyData));
    document.getElementById('simulateClean').addEventListener('click', () => createChart(cleanData));
    createChart(bouncyData);
});
</script>

</body>
</html>
